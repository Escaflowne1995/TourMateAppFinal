<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Save Functionality</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Test Save Functionality</h1>
        
        <div id="status" class="mb-6 p-4 rounded-lg bg-blue-100 text-blue-800">
            Testing connection...
        </div>
        
        <form id="test-form" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Name</label>
                <input type="text" id="name" name="name" required class="mt-1 block w-full rounded-lg border border-gray-300 p-3" placeholder="Enter name">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700">Origin (City/Town)</label>
                <select id="origin" name="origin" required class="mt-1 block w-full rounded-lg border border-gray-300 p-3">
                    <option value="">Select Location</option>
                    <option value="Cebu City">Cebu City</option>
                    <option value="Mandaue City">Mandaue City</option>
                    <option value="Lapu-Lapu City">Lapu-Lapu City</option>
                </select>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700">Description</label>
                <textarea id="description" name="description" rows="3" class="mt-1 block w-full rounded-lg border border-gray-300 p-3" placeholder="Enter description"></textarea>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700">Image URL</label>
                <input type="url" id="image_url" name="image_url" class="mt-1 block w-full rounded-lg border border-gray-300 p-3" placeholder="https://example.com/image.jpg">
            </div>
            
            <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700">
                Test Save
            </button>
        </form>
        
        <div id="result" class="mt-6 p-4 rounded-lg hidden"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://huzmuglxzkaztzxjerym.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1em11Z2x4emthenR6eGplcnltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwNTAwOTUsImV4cCI6MjA3MjYyNjA5NX0.Z4kYsI4OIOvMo1o8uKg6ckBpu2LDAA7q6iKReJUftHw';
        
        let supabase;
        
        // Initialize Supabase
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            document.getElementById('status').textContent = '‚úÖ Connected to Supabase';
            document.getElementById('status').className = 'mb-6 p-4 rounded-lg bg-green-100 text-green-800';
        } catch (error) {
            document.getElementById('status').textContent = '‚ùå Failed to connect to Supabase: ' + error.message;
            document.getElementById('status').className = 'mb-6 p-4 rounded-lg bg-red-100 text-red-800';
        }
        
        // Test form submission
        document.getElementById('test-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            console.log('Form data:', data);
            
            // Validate required fields
            if (!data.name || !data.origin) {
                showResult('‚ùå Please fill in all required fields', 'error');
                return;
            }
            
            try {
                showResult('üîÑ Saving...', 'info');
                
                // Add required fields
                data.is_active = true;
                data.created_at = new Date().toISOString();
                
                console.log('Saving data:', data);
                
                const response = await supabase.from('local_delicacies').insert(data);
                
                console.log('Save response:', response);
                
                if (response.error) {
                    showResult('‚ùå Error: ' + response.error.message, 'error');
                } else {
                    showResult('‚úÖ Successfully saved! Data: ' + JSON.stringify(response.data, null, 2), 'success');
                }
                
            } catch (error) {
                console.error('Save error:', error);
                showResult('‚ùå Unexpected error: ' + error.message, 'error');
            }
        });
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = 'mt-6 p-4 rounded-lg';
            
            if (type === 'success') {
                resultDiv.className += ' bg-green-100 text-green-800';
            } else if (type === 'error') {
                resultDiv.className += ' bg-red-100 text-red-800';
            } else {
                resultDiv.className += ' bg-blue-100 text-blue-800';
            }
            
            resultDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>
